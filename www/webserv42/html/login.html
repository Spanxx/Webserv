<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Login</title>
	<link rel="stylesheet" href="/html/login.css">
</head>
<body>
	<div class="login-container">
		<h2>Login</h2>
		<form id="login-form">
			<label for="email">E-Mail</label>
			<input type="text" id="email" name="email" required>

			<label for="password">Password</label>
			<input type="password" id="password" name="password" required>

			<input type="hidden" name="source" value="login">
			<button type="submit">Login</button>

			<br></br>
			<a href="/html/newUser.html" class="button-link">Create new user</a>
		</form>
	</div>

	<script>
	document.getElementById('login-form').addEventListener('submit', function(event) {
		event.preventDefault();

		// const username = document.getElementById('username').value;
		const email = document.getElementById('email').value;
		const password = document.getElementById('password').value;
		const authType = document.querySelector('[name="source"]').value;

		// Daten als x-www-form-urlencoded kodieren
		const formData = new URLSearchParams();
		formData.append('email', email);
		formData.append('password', password);
		formData.append('source', authType);

		console.log(formData.toString());

		fetch('/{{CGI_BIN}}userAuth.py', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/x-www-form-urlencoded',
			},
			body: formData.toString()
		})
		.then(response => response.json())
		.then(data => {
			if (data.status === "ok") {
				window.location.href = response.url;
			} else {
				alert("Error: " + (data.message || "Login failed."));
			}
		})


		// .then(data => {
		// // .then(response => {
		// if (response.redirected) {
		// 	// manually navigate the browser
		// 	window.location.href = response.url;
		// } else {
		// 	alert("Login failed: " + data.message);
		// 	console.log("Server response: ", data)
		// 	// optional: handle login error or show message
		// 	// console.log('Login failed or no redirect.');
		// }
		// })
		.catch(error => {
			console.error("Send error: ", error);
		});
	});
	</script>

</body>
</html>
